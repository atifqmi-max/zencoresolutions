<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - ZenCore Solutions</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #6366f1;
            --secondary-color: #4f46e5;
            --dark-color: #1e293b;
            --light-color: #f8fafc;
            --gray-color: #64748b;
            --success-color: #22c55e;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f1f5f9;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Admin Header */
        .admin-header {
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .admin-email {
            color: var(--gray-color);
        }

        .logout-btn {
            padding: 0.5rem 1rem;
            background: var(--danger-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: #dc2626;
        }

        /* Admin Dashboard */
        .dashboard {
            padding: 2rem 0;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-title {
            color: var(--gray-color);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--dark-color);
        }

        .stat-change {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: var(--success-color);
        }

        /* Analytics Section */
        .analytics-section {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-header h2 {
            color: var(--dark-color);
            font-size: 1.3rem;
        }

        .date-range {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .date-range input {
            padding: 0.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
        }

        .date-range button {
            padding: 0.5rem 1rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .date-range button:hover {
            background: var(--secondary-color);
        }

        .analytics-table {
            overflow-x: auto;
        }

        .analytics-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .analytics-table th {
            background: var(--light-color);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--dark-color);
        }

        .analytics-table td {
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .analytics-table tr:hover {
            background: #f8fafc;
        }

        /* Settings Grid */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .settings-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .settings-card h3 {
            color: var(--dark-color);
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--dark-color);
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #16a34a;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
        }

        /* Code List */
        .code-list {
            margin-top: 1rem;
        }

        .code-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            margin-bottom: 0.5rem;
            transition: background 0.3s;
        }

        .code-item:hover {
            background: #f8fafc;
        }

        .code-info h4 {
            margin-bottom: 0.3rem;
            color: var(--dark-color);
        }

        .code-info p {
            color: var(--gray-color);
            font-size: 0.9rem;
        }

        .code-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            padding: 0.3rem 0.8rem;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s;
        }

        .edit-btn {
            background: var(--warning-color);
            color: white;
        }

        .edit-btn:hover {
            background: #d97706;
        }

        .delete-btn {
            background: var(--danger-color);
            color: white;
        }

        .delete-btn:hover {
            background: #dc2626;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            overflow-y: auto;
        }

        .modal-content {
            background: white;
            max-width: 600px;
            margin: 2rem auto;
            border-radius: 10px;
            overflow: hidden;
        }

        .modal-header {
            padding: 1rem;
            background: var(--primary-color);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.2rem;
        }

        .close-modal {
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: var(--dark-color);
        }

        .modal-body {
            padding: 1.5rem;
        }

        /* Success Message */
        .success-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success-color);
            color: white;
            padding: 1rem;
            border-radius: 5px;
            display: none;
            animation: slideIn 0.3s ease;
            z-index: 3000;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .section-header {
                flex-direction: column;
                gap: 1rem;
            }
            
            .date-range {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="admin-header">
        <div class="container">
            <div class="header-content">
                <div class="logo" id="siteLogo">ZenCore Solutions</div>
                <div class="admin-info">
                    <span class="admin-email">atifqmi@gmail.com</span>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="dashboard">
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-title">Total Codes</div>
                    <div class="stat-value" id="totalCodes">0</div>
                    <div class="stat-change">↑ All time</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Total Page Views</div>
                    <div class="stat-value" id="totalViews">0</div>
                    <div class="stat-change" id="viewsChange">↑ This month</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Unique Visitors</div>
                    <div class="stat-value" id="uniqueVisitors">0</div>
                    <div class="stat-change" id="visitorsChange">This month</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Total Admins</div>
                    <div class="stat-value" id="totalAdmins">1</div>
                    <div class="stat-change">Active accounts</div>
                </div>
            </div>

            <!-- Analytics Section -->
            <div class="analytics-section">
                <div class="section-header">
                    <h2>Page View Analytics</h2>
                    <div class="date-range">
                        <input type="date" id="startDate">
                        <input type="date" id="endDate">
                        <button onclick="updateAnalytics()">Apply</button>
                        <button class="btn-warning" onclick="resetDateRange()">Reset</button>
                    </div>
                </div>
                <div class="analytics-table">
                    <table id="analyticsTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Page</th>
                                <th>Views</th>
                                <th>Unique Visitors</th>
                            </tr>
                        </thead>
                        <tbody id="analyticsBody">
                            <!-- Analytics data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Settings Grid -->
            <div class="settings-grid">
                <!-- Website Settings -->
                <div class="settings-card">
                    <h3>Website Settings</h3>
                    <div class="form-group">
                        <label for="siteName">Website Name</label>
                        <input type="text" id="siteName" placeholder="Enter website name">
                    </div>
                    <button class="btn btn-primary" onclick="updateSiteName()">Update Site Name</button>
                </div>

                <!-- Add New Admin -->
                <div class="settings-card">
                    <h3>Add New Admin</h3>
                    <div class="form-group">
                        <label for="newAdminEmail">Admin Email</label>
                        <input type="email" id="newAdminEmail" placeholder="Enter email">
                    </div>
                    <div class="form-group">
                        <label for="newAdminPassword">Password</label>
                        <input type="password" id="newAdminPassword" placeholder="Enter password">
                    </div>
                    <button class="btn btn-success" onclick="addNewAdmin()">Add Admin</button>
                </div>

                <!-- Add New Code -->
                <div class="settings-card">
                    <h3>Add New Code</h3>
                    <form id="addCodeForm">
                        <div class="form-group">
                            <label for="codeTitle">Title *</label>
                            <input type="text" id="codeTitle" required>
                        </div>
                        <div class="form-group">
                            <label for="codeCategory">Category</label>
                            <select id="codeCategory">
                                <option value="html">HTML/CSS</option>
                                <option value="javascript">JavaScript</option>
                                <option value="python">Python</option>
                                <option value="react">React</option>
                                <option value="node">Node.js</option>
                                <option value="database">Database</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="codePhoto">Photo URL</label>
                            <input type="url" id="codePhoto" placeholder="https://example.com/image.jpg">
                        </div>
                        <div class="form-group">
                            <label for="code1">Code Section 1 *</label>
                            <textarea id="code1" required></textarea>
                        </div>
                        <div class="form-group" id="code2Section">
                            <label for="code2">Code Section 2</label>
                            <textarea id="code2"></textarea>
                        </div>
                        <button type="button" class="btn btn-warning" onclick="addCodeSection()" style="margin-bottom: 1rem;">+ Add More Code Section</button>
                        <div class="form-group">
                            <label for="codeLink">Link (Optional)</label>
                            <input type="url" id="codeLink" placeholder="https://example.com">
                        </div>
                        <div class="form-group">
                            <label for="madeBy">Made By</label>
                            <input type="text" id="madeBy" placeholder="Author name">
                        </div>
                        <div class="form-group">
                            <label for="contactLink">Contact Link</label>
                            <input type="url" id="contactLink" placeholder="https://example.com/contact">
                        </div>
                        <button type="submit" class="btn btn-primary">Add Code</button>
                    </form>
                </div>

                <!-- Admin List -->
                <div class="settings-card">
                    <h3>Admin List</h3>
                    <div class="code-list" id="adminList">
                        <!-- Admin list will be loaded here -->
                    </div>
                </div>

                <!-- Code List -->
                <div class="settings-card" style="grid-column: 1/-1;">
                    <h3>Manage Codes</h3>
                    <div class="code-list" id="codeList">
                        <!-- Codes will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Code Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Code</h3>
                <span class="close-modal" onclick="closeEditModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editCodeForm">
                    <input type="hidden" id="editCodeId">
                    <div class="form-group">
                        <label for="editTitle">Title</label>
                        <input type="text" id="editTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="editCategory">Category</label>
                        <select id="editCategory">
                            <option value="html">HTML/CSS</option>
                            <option value="javascript">JavaScript</option>
                            <option value="python">Python</option>
                            <option value="react">React</option>
                            <option value="node">Node.js</option>
                            <option value="database">Database</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editPhoto">Photo URL</label>
                        <input type="url" id="editPhoto">
                    </div>
      <div class="form-group">
                        <label for="editCode1">Code Section 1</label>
                        <textarea id="editCode1" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="editCode2">Code Section 2</label>
                        <textarea id="editCode2"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="editLink">Link</label>
                        <input type="url" id="editLink">
                    </div>
                    <div class="form-group">
                        <label for="editMadeBy">Made By</label>
                        <input type="text" id="editMadeBy">
                    </div>
                    <div class="form-group">
                        <label for="editContactLink">Contact Link</label>
                        <input type="url" id="editContactLink">
                    </div>
                    <button type="submit" class="btn btn-primary">Update Code</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Success Message -->
    <div id="successMessage" class="success-message">
        <span id="successText">Operation completed successfully!</span>
    </div>

    <script>
        // Check authentication
        function checkAuth() {
            const loggedIn = localStorage.getItem('adminLoggedIn');
            if (loggedIn !== 'true') {
                window.location.href = 'admin-login.html';
            }
        }

        // Load site name
        function loadSiteName() {
            const savedName = localStorage.getItem('siteName');
            if (savedName) {
                document.getElementById('siteLogo').textContent = savedName;
                document.getElementById('siteName').value = savedName;
            }
        }

        // Update site name
        function updateSiteName() {
            const newName = document.getElementById('siteName').value.trim();
            if (newName) {
                localStorage.setItem('siteName', newName);
                document.getElementById('siteLogo').textContent = newName;
                showSuccess('Website name updated successfully!');
            }
        }

        // Add new admin
        function addNewAdmin() {
            const email = document.getElementById('newAdminEmail').value.trim();
            const password = document.getElementById('newAdminPassword').value;
            
            if (!email || !password) {
                alert('Please fill in all fields');
                return;
            }
            
            const admins = JSON.parse(localStorage.getItem('admins')) || [];
            
            // Check if admin already exists
            if (admins.some(admin => admin.email === email)) {
                alert('Admin with this email already exists');
                return;
            }
            
            admins.push({
                email: email,
                password: password,
                addedBy: 'atifqmi@gmail.com',
                addedDate: new Date().toISOString()
            });
            
            localStorage.setItem('admins', JSON.stringify(admins));
            
            document.getElementById('newAdminEmail').value = '';
            document.getElementById('newAdminPassword').value = '';
            
            loadAdminList();
            updateStats();
            showSuccess('New admin added successfully!');
        }

        // Load admin list
        function loadAdminList() {
            const admins = JSON.parse(localStorage.getItem('admins')) || [];
            const adminList = document.getElementById('adminList');
            
            if (admins.length === 0) {
                adminList.innerHTML = '<p>No additional admins found.</p>';
                return;
            }
            
            adminList.innerHTML = admins.map(admin => `
                <div class="code-item">
                    <div class="code-info">
                        <h4>${admin.email}</h4>
                        <p>Added: ${new Date(admin.addedDate).toLocaleDateString()}</p>
                    </div>
                    <div class="code-actions">
                        <button class="action-btn delete-btn" onclick="deleteAdmin('${admin.email}')">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // Delete admin
        function deleteAdmin(email) {
            if (email === 'atifqmi@gmail.com') {
                alert('Cannot delete the main admin account');
                return;
            }
            
            if (confirm('Are you sure you want to delete this admin?')) {
                let admins = JSON.parse(localStorage.getItem('admins')) || [];
                admins = admins.filter(admin => admin.email !== email);
                localStorage.setItem('admins', JSON.stringify(admins));
                loadAdminList();
                updateStats();
                showSuccess('Admin deleted successfully!');
            }
        }

        // Add code section
        let codeSectionCount = 2;
        function addCodeSection() {
            codeSectionCount++;
            const section = document.createElement('div');
            section.className = 'form-group';
            section.id = `code${codeSectionCount}Section`;
            section.innerHTML = `
                <label for="code${codeSectionCount}">Code Section ${codeSectionCount}</label>
                <textarea id="code${codeSectionCount}"></textarea>
            `;
            document.getElementById('addCodeForm').insertBefore(section, document.getElementById('codeLink').parentNode);
        }

        // Add new code
        document.getElementById('addCodeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const codes = JSON.parse(localStorage.getItem('codes')) || [];
            
            const newCode = {
                id: Date.now().toString(),
                title: document.getElementById('codeTitle').value,
                category: document.getElementById('codeCategory').value,
                photo: document.getElementById('codePhoto').value,
                code1: document.getElementById('code1').value,
                code2: document.getElementById('code2').value,
                link: document.getElementById('codeLink').value,
                madeBy: document.getElementById('madeBy').value,
                contactLink: document.getElementById('contactLink').value,
                date: new Date().toISOString()
            };
            
            // Add additional code sections
            for (let i = 3; i <= codeSectionCount; i++) {
                const section = document.getElementById(`code${i}`);
                if (section && section.value) {
                    newCode[`code${i}`] = section.value;
                }
            }
            
            codes.push(newCode);
            localStorage.setItem('codes', JSON.stringify(codes));
            
            // Reset form
            this.reset();
            codeSectionCount = 2;
            
            loadCodeList();
            updateStats();
            showSuccess('Code added successfully!');
        });

        // Load code list
        function loadCodeList() {
            const codes = JSON.parse(localStorage.getItem('codes')) || [];
            const codeList = document.getElementById('codeList');
            
            if (codes.length === 0) {
                codeList.innerHTML = '<p>No codes added yet.</p>';
                return;
            }
            
            // Sort by date (newest first)
            const sortedCodes = [...codes].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            codeList.innerHTML = sortedCodes.map(code => `
                <div class="code-item">
                    <div class="code-info">
                        <h4>${code.title}</h4>
                        <p>Added: ${new Date(code.date).toLocaleDateString()} | By: ${code.madeBy || 'Anonymous'}</p>
                    </div>
                    <div class="code-actions">
                        <button class="action-btn edit-btn" onclick="editCode('${code.id}')">Edit</button>
                        <button class="action-btn delete-btn" onclick="deleteCode('${code.id}')">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // Edit code
        function editCode(codeId) {
            const codes = JSON.parse(localStorage.getItem('codes')) || [];
            const code = codes.find(c => c.id === codeId);
            
            if (!code) return;
            
            document.getElementById('editCodeId').value = code.id;
            document.getElementById('editTitle').value = code.title || '';
            document.getElementById('editCategory').value = code.category || 'html';
            document.getElementById('editPhoto').value = code.photo || '';
            document.getElementById('editCode1').value = code.code1 || '';
            document.getElementById('editCode2').value = code.code2 || '';
            document.getElementById('editLink').value = code.link || '';
            document.getElementById('editMadeBy').value = code.madeBy || '';
            document.getElementById('editContactLink').value = code.contactLink || '';
            
            document.getElementById('editModal').style.display = 'block';
        }
       // Update code
        document.getElementById('editCodeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const codeId = document.getElementById('editCodeId').value;
            const codes = JSON.parse(localStorage.getItem('codes')) || [];
            const index = codes.findIndex(c => c.id === codeId);
            
            if (index !== -1) {
                codes[index] = {
                    ...codes[index],
                    title: document.getElementById('editTitle').value,
                    category: document.getElementById('editCategory').value,
                    photo: document.getElementById('editPhoto').value,
                    code1: document.getElementById('editCode1').value,
                    code2: document.getElementById('editCode2').value,
                    link: document.getElementById('editLink').value,
                    madeBy: document.getElementById('editMadeBy').value,
                    contactLink: document.getElementById('editContactLink').value,
                    lastEdited: new Date().toISOString()
                };
                
                localStorage.setItem('codes', JSON.stringify(codes));
                closeEditModal();
                loadCodeList();
                showSuccess('Code updated successfully!');
            }
        });

        // Close edit modal
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        // Delete code
        function deleteCode(codeId) {
            if (confirm('Are you sure you want to delete this code?')) {
                let codes = JSON.parse(localStorage.getItem('codes')) || [];
                codes = codes.filter(code => code.id !== codeId);
                localStorage.setItem('codes', JSON.stringify(codes));
                loadCodeList();
                updateStats();
                showSuccess('Code deleted successfully!');
            }
        }

        // Load analytics
        function loadAnalytics() {
            const views = JSON.parse(localStorage.getItem('pageViews')) || [];
            const endDate = new Date();
            const startDate = new Date();
            startDate.setMonth(startDate.getMonth() - 1); // Default: last month
            
            document.getElementById('startDate').value = startDate.toISOString().split('T')[0];
            document.getElementById('endDate').value = endDate.toISOString().split('T')[0];
            
            updateAnalytics();
        }

        // Update analytics with date range
        function updateAnalytics() {
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
            endDate.setHours(23, 59, 59, 999);
            
            const views = JSON.parse(localStorage.getItem('pageViews')) || [];
            
            // Filter views by date range
            const filteredViews = views.filter(view => {
                const viewDate = new Date(view.timestamp);
                return viewDate >= startDate && viewDate <= endDate;
            });
            
            // Group by date and page
            const analytics = {};
            filteredViews.forEach(view => {
                const date = new Date(view.timestamp).toLocaleDateString();
                const key = `${date}_${view.page}`;
                
                if (!analytics[key]) {
                    analytics[key] = {
                        date: date,
                        page: view.page,
                        views: 0,
                        uniqueVisitors: new Set()
                    };
                }
                
                analytics[key].views++;
                analytics[key].uniqueVisitors.add(view.userAgent);
            });
            
            // Convert to array and sort
            const analyticsArray = Object.values(analytics).sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );
            
            // Display analytics
            const tbody = document.getElementById('analyticsBody');
            if (analyticsArray.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">No data available for this period</td></tr>';
            } else {
                tbody.innerHTML = analyticsArray.map(item => `
                    <tr>
                        <td>${item.date}</td>
                        <td>${item.page}</td>
                        <td>${item.views}</td>
                        <td>${item.uniqueVisitors.size}</td>
                    </tr>
                `).join('');
            }
            
            updateStats();
        }

        // Reset date range to default (1 month)
        function resetDateRange() {
            const endDate = new Date();
            const startDate = new Date();
            startDate.setMonth(startDate.getMonth() - 1);
            
            document.getElementById('startDate').value = startDate.toISOString().split('T')[0];
            document.getElementById('endDate').value = endDate.toISOString().split('T')[0];
            
            updateAnalytics();
        }

        // Update stats
        function updateStats() {
            const codes = JSON.parse(localStorage.getItem('codes')) || [];
            const views = JSON.parse(localStorage.getItem('pageViews')) || [];
            const admins = JSON.parse(localStorage.getItem('admins')) || [];
            
            document.getElementById('totalCodes').textContent = codes.length;
            document.getElementById('totalViews').textContent = views.length;
            document.getElementById('totalAdmins').textContent = admins.length + 1; // +1 for main admin
            
            // Calculate unique visitors for current month
            const now = new Date();
            const monthAgo = new Date();
            monthAgo.setMonth(monthAgo.getMonth() - 1);
            
            const monthViews = views.filter(view => new Date(view.timestamp) >= monthAgo);
            const uniqueVisitors = new Set(monthViews.map(view => view.userAgent)).size;
            
            document.getElementById('uniqueVisitors').textContent = uniqueVisitors;
            
            // Calculate change from previous month
            const twoMonthsAgo = new Date();
            twoMonthsAgo.setMonth(twoMonthsAgo.getMonth() - 2);
            
            const prevMonthViews = views.filter(view => {
                const viewDate = new Date(view.timestamp);
                return viewDate >= twoMonthsAgo && viewDate < monthAgo;
            });
            
            const prevUniqueVisitors = new Set(prevMonthViews.map(view => view.userAgent)).size;
            
            const change = uniqueVisitors - prevUniqueVisitors;
            const changePercent = prevUniqueVisitors ? ((change / prevUniqueVisitors) * 100).toFixed(1) : 0;
            
            document.getElementById('visitorsChange').textContent = 
                `${change > 0 ? '↑' : '↓'} ${Math.abs(changePercent)}% from last month`;
        }

        // Show success message
        function showSuccess(message) {
            document.getElementById('successText').textContent = message;
            document.getElementById('successMessage').style.display = 'block';
            
            setTimeout(() => {
                document.getElementById('successMessage').style.display = 'none';
            }, 3000);
        }

        // Logout
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('adminLoggedIn');
                window.location.href = 'admin-login.html';
            }
        }

        // Initialize
        checkAuth();
        loadSiteName();
        loadAdminList();
        loadCodeList();
        loadAnalytics();
        updateStats();

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target === modal) {
                closeEditModal();
            }
        }

        // Auto refresh every 30 seconds
        setInterval(() => {
            loadCodeList();
            updateAnalytics();
        }, 30000);
    </script>
</body>
</html>
